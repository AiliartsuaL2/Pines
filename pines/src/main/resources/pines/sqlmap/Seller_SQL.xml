<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SellerSpace">
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/> <!-- 출력시(select) 필요한  list를 담는 변수 -->
	<typeAlias  alias="mainVO" type="pines.service.MainVO"/> <!-- 출력시(select) 필요한 변수 -->
	
	<select id="sellerDAO.selectStoreNameCheck" resultClass = "java.lang.Integer">
		SELECT COUNT(*) 
		  FROM STORE
	     WHERE STORE_NAME = #storeName#
	</select>
	
	<select id="sellerDAO.selectStoreBusNumCheck" resultClass = "java.lang.Integer">
		SELECT COUNT(*) 
		  FROM STORE
	     WHERE BUSINESS_REG_NUM = #businessRegNum#
	</select>
	
	<insert id="sellerDAO.insertSellerWrite">
		INSERT INTO STORE( 
							STORE_ID
						  , USER_ID
						  , BUSINESS_REG_NUM
						  , STORE_NAME
						  , SELLER_TYPE
						  , SIGN_STORE
						  , ACCOUNT_NUMBER
						  , BANK_NAME
						  , ACCOUNT_HOLDER
						  , STORE_REG_DATE
							)
					VALUES(
							  STORE_SEQ.NEXTVAL
							, #userId#
							, #businessRegNum#
							, #storeName#
							, #sellerType#
							, 'Y'
							, #accountNumber#
							, #bankName#
							, #accountHolder#
							, SYSDATE
						  )
	</insert>
	
	<select id="sellerDAO.selectSellerDeleteCheck" resultClass = "java.lang.Integer">
		SELECT COUNT(*) 
		  FROM STORE
	     WHERE USER_ID = #userId#
	       AND STORE_NAME = #storeName#
	       AND BUSINESS_REG_NUM = #businessRegNum#
	</select>
	
	
	<update id="sellerDAO.updateSellerDeleteSub">
  		UPDATE STORE
  		SET SIGN_STORE = 'N'
  		  , STORE_ID = 0
  		WHERE USER_ID= #userId#
  		  AND BUSINESS_REG_NUM = #businessRegNum#
  		  AND STORE_NAME = #storeName#
	</update>
	
	
		<select id="sellerDAO.selectSellerOrderDetail" resultClass="egovMap">
      SELECT (
              SELECT DISCOUNT_WON
                FROM PRODUCT_OPTION po 
               WHERE po.OPTION_ID = p.OPTION_ID 
              ) AS DISCOUNT_WON 
              , 
              (
               SELECT TOTAL_NUM 
                FROM PRODUCT_OPTION po 
               WHERE po.OPTION_ID = p.OPTION_ID 
              ) AS TOTAL_NUM  
              , o.USER_ID
              , o.ORDER_ZIPCODE
              , o.ORDER_ADDRESS
              , p.PRODUCT_ID 
              , p.PRODUCT_NAME 
              , p.PRODUCT_PRICE 
              , p.IMAGE1 
              , p.SHIPPING_COST
              , p.FREE_SHIPPING_PRICE
              , o.ORDER_ID 
              , o.NUM_OF_PRODUCT 
	          , to_char(o.PURCHASE_DATE,'yyyy"년" mm"월" dd"일" HH24"시"MI"분"') PURCHASE_DATE 
              , o.DELIVERY_STATUS
              , o.TOTAL_AMOUNT
              , o.ORDER_OPTION
              , (
                 SELECT s.STORE_NAME
                   FROM STORE s
                  WHERE p.STORE_ID = s.STORE_ID
                ) STORE_NAME
      	FROM "ORDER" o join PRODUCT p 
       	  ON o.PRODUCT_ID = p.PRODUCT_ID 
       WHERE ORDER_ID = #orderId#
		</select>
		
		<update id="sellerDAO.updateDeliveryStatus">
  			UPDATE "ORDER"
  			SET DELIVERY_STATUS = #deliveryStatus#
  			WHERE ORDER_ID= #orderId#
		</update>
	
	
	
</sqlMap>